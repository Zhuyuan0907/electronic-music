# 更新日誌

## 版本 2.0 - 麵包板視覺化更新 (2025-12-11)

### 🎨 重大視覺改進

#### 1. **麵包板 LED 模擬效果**
- ✅ 真實的麵包板背景（咖啡色底板 + 孔洞紋理）
- ✅ 每條軌道 5 個 LED 燈，從上到下排列
- ✅ LED 發光效果（亮起時有光暈）
- ✅ LED 腳位視覺化（兩隻小腳）
- ✅ 音符下落時對應 LED 會依序亮起

**視覺對比**：
- 之前：黑色畫面 + 簡單的長條音符
- 現在：麵包板 + LED 燈 + 按鈕，像真的硬體！

#### 2. **實體按鈕視覺**
- ✅ 4 個紅色按鈕在底部
- ✅ 按下時有 3D 按壓效果
- ✅ 按鈕上顯示鍵位標籤（D/F/J/K）
- ✅ 高光和陰影效果

#### 3. **音樂播放功能**
- ✅ 支援 MP3/WAV/OGG 格式
- ✅ 自動載入譜面中指定的音訊檔案
- ✅ 支援 offset 調整同步
- ✅ 遊戲結束時自動停止音樂

### 📝 技術改進

#### 遊戲渲染 ([public/js/game.js](public/js/game.js))
- 新增 `updateLEDStates()` - 根據音符位置更新 LED 狀態
- 新增 `drawBreadboard()` - 繪製麵包板背景和紋理
- 新增 `drawLEDs()` - 繪製所有 LED 燈
- 新增 `drawLED()` - 繪製單個 LED（亮/暗兩種狀態）
- 新增 `drawButtons()` - 繪製按鈕陣列
- 新增 `drawButton()` - 繪製單個按鈕（按下/釋放狀態）
- 新增 `playAudio()` - 播放背景音樂
- 改進 `stop()` - 停止遊戲時同時停止音樂

#### 配置更新
- 新增 `ledsPerLane` - 每條軌道的 LED 數量（5個）
- 新增 `audio` - 音樂播放器實例
- 新增 `ledStates` - 二維陣列追蹤 LED 狀態

### 📁 新增檔案

- [charts/audio/README.md](charts/audio/README.md) - 音訊檔案使用說明
- [UPDATE_LOG.md](UPDATE_LOG.md) - 這個更新日誌

### 🎮 使用體驗改進

#### 之前的問題
❌ 畫面全黑，看不清楚發生什麼
❌ 沒有音樂，感覺很乾
❌ 不像實體硬體

#### 現在的體驗
✅ 清楚看到 LED 燈依序亮起（模擬音符下落）
✅ 可以搭配音樂遊玩（如果有音訊檔案）
✅ 視覺上就像真的麵包板硬體

### 🎯 視覺效果詳解

#### LED 燈狀態
```
熄滅狀態: 深灰藍色圓形（#112233）
亮起狀態: 青藍色發光（#00d4ff）+ 光暈效果
```

#### 遊戲流程視覺化
```
1. 遊戲開始
   └─> 所有 LED 熄滅

2. 音符出現
   └─> 對應軌道的最上方 LED 亮起

3. 音符下落
   └─> LED 依序從上往下亮起
       LED 1 → LED 2 → LED 3 → LED 4 → LED 5

4. 到達判定線（最下方 LED）
   └─> 玩家按下按鈕

5. 按鈕回饋
   └─> 按鈕 3D 按壓動畫
   └─> 判定顯示（Perfect/Great/Good/Miss）
```

### 🔊 音樂功能

#### 支援的格式
- MP3（推薦）
- WAV（高品質但檔案大）
- OGG（開源格式）

#### 如何添加音樂

**方法 1: 使用本地音樂**
```json
{
  "metadata": {
    "audioFile": "audio/my-song.mp3"
  }
}
```

**方法 2: 暫時不用音樂**
```json
{
  "metadata": {
    "audioFile": ""  // 空字串 = 沒有音樂
  }
}
```

#### 音樂同步
如果音樂和遊戲不同步：
```json
{
  "metadata": {
    "offset": 100  // 延遲 100ms
  }
}
```

### 📊 效能影響

- LED 繪製：每幀約 20 個 LED（4軌道 × 5個）
- 按鈕繪製：每幀 4 個按鈕
- 麵包板背景：只繪製一次紋理
- 整體效能：60 FPS 穩定

### 🐛 已知限制

1. **音訊播放**
   - 瀏覽器可能要求使用者互動後才能播放
   - 建議：點擊遊戲畫面一次啟用音訊

2. **LED 精確度**
   - LED 位置是近似計算，不是像素級精確
   - 但視覺效果已經足夠好

3. **音訊檔案**
   - 需要手動添加音訊檔案
   - 專案不包含示範音樂（版權考量）

### 🔜 未來計劃

- [ ] LED 顏色隨譜面難度變化
- [ ] 更多 LED 動畫效果（呼吸燈、流水燈）
- [ ] 支援自訂 LED 顏色主題
- [ ] 內建簡單的節拍器音效
- [ ] LED 殘影效果

### 📸 截圖對比

**之前（v1.0）**：
```
┌────────────────────────┐
│ 黑色背景               │
│                        │
│  ▓ ▓ ▓ ▓  ← 長條音符   │
│                        │
│  ▓ ▓ ▓ ▓               │
│                        │
│ ══════════ ← 紅色判定線│
└────────────────────────┘
```

**現在（v2.0）**：
```
┌────────────────────────┐
│ 麵包板背景（咖啡色）   │
│  ○ ○ ○ ○  ← LED（暗）  │
│  ● ○ ○ ○  ← LED 亮起！ │
│  ● ○ ● ○               │
│  ○ ○ ● ○               │
│  ○ ● ○ ●               │
│ ══════════ ← 判定線    │
│  🔴 🔴 🔴 🔴  ← 按鈕    │
│  D  F  J  K            │
└────────────────────────┘
```

### 💡 提示

1. **最佳體驗**：
   - 使用全螢幕模式
   - 添加背景音樂
   - 調整合適的音符速度

2. **除錯模式**：
   - 打開瀏覽器開發者工具（F12）
   - 查看 Console 的 LED 狀態輸出

3. **效能優化**：
   - 如果卡頓，可以減少 LED 數量
   - 或降低 Canvas 解析度

---

## 版本 1.0 - 初始發布 (2025-12-11)

- ✅ 基本遊戲架構
- ✅ WebSocket 即時通訊
- ✅ 譜面系統
- ✅ AI 譜面生成支援
- ✅ 基本 Canvas 渲染
- ✅ 樹莓派 GPIO 接口預留

---

感謝使用「板樂」！🎮🎵
