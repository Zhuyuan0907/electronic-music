# AI 譜面生成指南

這份文件提供給 AI 模型（如 GPT-4、Claude 等）用於生成音樂遊戲譜面。

## 目標

根據歌曲的音樂特性，生成一個有趣且可玩的下落式音樂遊戲譜面。

## 輸入資訊

AI 需要以下資訊來生成譜面：

1. **歌曲資訊**
   - 歌名 (title)
   - 藝術家 (artist)
   - BPM（每分鐘節拍數）
   - 歌曲長度（秒或毫秒）

2. **難度設定**
   - EASY: 適合新手
   - NORMAL: 適合一般玩家
   - HARD: 適合進階玩家
   - EXPERT: 適合專家級玩家

3. **軌道數量**（可選，預設 4）
   - 3-5 條軌道

## 生成規則

### 1. 音符時間點計算

```
每拍的時間（毫秒）= 60000 / BPM
16 分音符時間 = 每拍時間 / 4
8 分音符時間 = 每拍時間 / 2
4 分音符時間 = 每拍時間
```

**範例：**
- BPM 120 → 每拍 500ms
- 16 分音符 = 125ms
- 8 分音符 = 250ms
- 4 分音符 = 500ms

### 2. 難度設計原則

#### EASY (Level 1-3)
- **音符密度**: 低，主要在強拍（每小節第 1 拍）
- **最小間隔**: >= 500ms（4 分音符）
- **多押**: 很少，最多雙押
- **軌道使用**: 輪流使用，避免複雜移動
- **總音符數**: 歌曲長度（秒）× 1-2 個/秒

#### NORMAL (Level 4-7)
- **音符密度**: 中等，強拍 + 弱拍
- **最小間隔**: >= 250ms（8 分音符）
- **多押**: 適量雙押，偶爾三押
- **軌道使用**: 交替使用，簡單跳躍
- **總音符數**: 歌曲長度（秒）× 2-4 個/秒

#### HARD (Level 8-11)
- **音符密度**: 高，跟隨音樂旋律和節奏
- **最小間隔**: >= 125ms（16 分音符）
- **多押**: 頻繁雙押和三押
- **軌道使用**: 快速移動，複雜圖形
- **總音符數**: 歌曲長度（秒）× 4-6 個/秒

#### EXPERT (Level 12-15)
- **音符密度**: 極高，完整還原音樂細節
- **最小間隔**: >= 62.5ms（32 分音符，少量使用）
- **多押**: 大量多押，四押
- **軌道使用**: 極端移動，對稱圖形
- **總音符數**: 歌曲長度（秒）× 6-10 個/秒

### 3. 音符配置建議

1. **強拍優先**: 每小節第 1 拍通常應該有音符
2. **跟隨旋律**: 主旋律的音高變化可以映射到軌道位置
   - 高音 → 右側軌道 (lane 2-3)
   - 低音 → 左側軌道 (lane 0-1)
3. **節奏模式**: 重複的節奏應該有類似的音符模式
4. **呼吸空間**: 每 8-16 小節應該有較低密度的段落
5. **高潮段落**: 副歌或高潮部分應該增加音符密度

### 4. 避免的設計

❌ **禁止**：
- 物理上不可能的連打（單手 < 60ms）
- 超過 4 秒沒有任何音符（無聊）
- 連續 8 個以上相同軌道（重複）
- 不合理的難度突變

⚠️ **謹慎使用**：
- 四押（僅 EXPERT）
- 三押（HARD 以上）
- 快速軌道跳躍（NORMAL 以上）

## 輸出格式

請輸出符合 [schema.json](schema.json) 的 JSON 格式。

## AI Prompt 範本

### 範本 1: 基本生成

```
請為以下歌曲生成一個音樂遊戲譜面：

歌曲資訊：
- 標題: [歌名]
- 藝術家: [藝術家名]
- BPM: [數字]
- 長度: [秒數] 秒
- 難度: [EASY/NORMAL/HARD/EXPERT]
- 軌道數: 4

要求：
1. 音符應該跟隨音樂的節奏和旋律
2. 符合指定難度的音符密度
3. 保持遊戲的趣味性和可玩性
4. 輸出完整的 JSON 格式

請參考這個 JSON Schema:
[貼上 schema.json 內容]

輸出格式範例：
[貼上 demo-easy.json 內容]
```

### 範本 2: 根據音訊分析

```
我有一首歌曲的音訊分析資料：

- BPM: 128
- 拍號: 4/4
- 調性: C Major
- 能量值: 0.8 (高)
- 段落結構:
  * 0-8s: 前奏（低能量）
  * 8-32s: 主歌 A（中能量）
  * 32-56s: 副歌（高能量）
  * 56-80s: 主歌 B（中能量）
  * 80-104s: 副歌（高能量）
  * 104-120s: 尾奏（低能量）

請生成一個 NORMAL 難度的譜面，音符分布應該反映歌曲的能量變化。
```

### 範本 3: 增強既有譜面

```
這是一個 EASY 難度的譜面：
[貼上 JSON]

請將它改編成 HARD 難度版本，要求：
1. 增加音符密度（約 2-3 倍）
2. 添加更多雙押和三押
3. 加入 16 分音符的連打
4. 保持原有的基本節奏框架
```

## 驗證清單

生成譜面後，請檢查：

- [ ] 所有必要欄位都已填寫
- [ ] 音符時間按照遞增順序排列
- [ ] 軌道編號在有效範圍內（0 到 lanes-1）
- [ ] 音符類型為有效值（tap, hold, slide）
- [ ] 沒有物理上不可能的操作
- [ ] 難度標示與實際音符密度相符
- [ ] JSON 格式正確，可被解析

## 範例輸出

請參考 [examples/](examples/) 目錄中的範例檔案。

## 進階技巧

### 對稱設計
適合有規律節奏的歌曲：
```
lane: 0, 1, 2, 3, 3, 2, 1, 0
```

### 波浪設計
適合流暢的旋律：
```
lane: 0, 1, 2, 3, 2, 1, 0, 1
```

### 階梯設計
適合上升/下降的音階：
```
上升: lane: 0, 0, 1, 1, 2, 2, 3, 3
下降: lane: 3, 3, 2, 2, 1, 1, 0, 0
```

## 常見問題

**Q: 如何決定哪些音符應該是雙押？**
A: 雙押通常用於：
- 鼓聲的大鼓 (kick) + 小鼓 (snare)
- 和弦的開始
- 強調重要的節拍

**Q: 長按音符 (hold) 什麼時候使用？**
A: 目前版本主要使用 tap 音符。hold 和 slide 為未來功能預留。

**Q: 怎麼處理變速歌曲？**
A: 使用 `timing` 陣列記錄 BPM 變化點。

## 參考資源

- [音樂理論基礎](https://en.wikipedia.org/wiki/Music_theory)
- [節奏遊戲設計](https://en.wikipedia.org/wiki/Rhythm_game)
- BPM 計算器：60000 / BPM = 每拍毫秒數
